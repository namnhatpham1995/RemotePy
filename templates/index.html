<!DOCTYPE html>
<html>
	<style>
		@font-face {
		    font-family: roboto;
		    src: url({{ url_for('static', filename='fonts/roboto/Roboto-Regular.woff') }});
		}

		body {
			font-family: roboto;
		}

		img {
			max-width: 100%;
			max-height: 100vh;
			height: auto;
		}

		.screen {
			background: #ff6860;
			border: 1px solid #474e5d;
			border-radius: 1px;
			overflow: hidden;
		}

        ulli {
            float:left; //or display:inline-block;
        }
	</style>
	
	<head>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/materialize.min.css') }}"  media="screen,projection"/>
        <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}"/>
        <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/jquery.mobile-1.5.0-alpha.1.min.css') }}"/>

        <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.mobile-1.5.0-alpha.1.min.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
		<script type="text/javascript" src="{{ url_for('static', filename='js/jquery-3.5.1.min.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.mousewheel.min.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.finger.min.js') }}"></script>

		<!--
        <script type="text/javascript" src="{{ url_for('static', filename='js/materialize.min.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.finger.min.js') }}"></script>
        <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='css/jquery.mobile-1.5.0-alpha.1.min.css') }}"/>
        <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.mobile-1.5.0-alpha.1.min.js') }}"></script>
        -->


		<title>RemotePy Desktop</title>
	</head>

	<body>

		<div class="row">
			<div class="col s12" tabindex="-1">
				<img style="float: left" class="screen" id="screen" src="{{ url_for('video_feed') }}" width = 100% height = 100% draggable="false"
                tabindex="-1">
            </div>
		</div>

        <div class="row">

			<div class="row">
				<div class="col s2 offset-s2">
					<form action="" method=post enctype=multipart/form-data>

                        <div class="form-group">
                            <input class="form-control-file form-control-sm" type=file name=file style="margin-bottom: 5px"
                            id="upload_file" tabindex="-1">
                            <br>
                            <label size="20px">Choose file to transfer to PC</label>
                            <br>
                            <!--
                            <input type="button" class="btn btn-primary" value="Upload" id="upload_button">
                            -->

                        </div>

                    </form>
				</div>

                <div class="col s2 offset-s1">
                    <button class="btn btn-primary" type="button" id="upload_button" tabindex="-1">
                        <i class="fa fa-cloud-upload"></i> Upload to PC</button>
                </div>

				<div class="col s2 offset-s1">
                    <a href="/downloadfile/" target="blank" tabindex="-1">
					<button class="btn btn-primary" type=submit id="download" tabindex="-1">
                        <i class="fa fa-cloud-download"></i> Download to oneye</button>
                    </a>
				</div>

			</div>

		</div>

	</body>

	<script>
		function get_xy(event, offset){
			// function to get position of event on image
			if(event.pageX == null){
				// for mobile
				var x = event.x - offset.left
				var y = event.y - offset.top;
			}
			else{
				// for pc
				var x = event.pageX - offset.left
				var y = event.pageY - offset.top;

			}

			return [x,y];
		}


		function mouse_event(screen, event, type) {
			var offset = screen.offset();
			var point = get_xy(event, offset);
			console.log(type);

			$.ajax({
				type: 'POST',
				url: "/mouse",
				data: {
						"type": type,
						"x": point[0],
						"y": point[1],
						"X": screen.width(),
						"Y": screen.height()
					},
				success: function(result) { }
			});
		}


		$(document).ready(function() {

			$.Finger.doubleTapInterval = 2000;
			document.oncontextmenu = function() {return false;};

			<!--mouse action jquery -->
			/*$('#screen').on('doubletap dblclick', function(event) {
				var screen = $(this);
				mouse_event(screen, event, "dblclick");
			});*/

			$('#screen').on("tap", function tapHandler(event) {
				var screen = $(this);
				mouse_event(screen, event, "click");
			});

            <!--Remove Click and Double Click, Add mouse press and mouse release-->
            $('#screen').on('mousedown', function(event) {
				event.preventDefault();
				var screen = $(this);
				mouse_event(screen, event, "mousepress");
			});
            $('#screen').on('mouseup', function(event) {
				event.preventDefault();
				var screen = $(this);
				mouse_event(screen, event, "mouserelease");
			});

			$('#screen').on('taphold contextmenu', function(event) {
				event.preventDefault();
				var screen = $(this);
				mouse_event(screen, event, "rightclick");
			});
            <!--Add mousescroll up and down -->
			$('#screen').on('mousewheel', function(event) {
				event.preventDefault();
				var screen = $(this);
                if(event.originalEvent.wheelDelta > 0) {
                    mouse_event(screen, event, "mousewheelup");
                }
                else{
                    mouse_event(screen, event, "mousewheeldown");
                }

			});
            <!--Add check mouse position (for drag action) -->
            $('#screen').on('mousemove', function(event) {
				event.preventDefault();
				var screen = $(this);
				mouse_event(screen, event, "mousemove");
				setTimeout(10);
			});

            /* Send text keyboard*/
			$('html').keydown( function(event) {
                var text    = event.key;
                if (text == "ArrowDown")
                {
                    text = "down";
                }
                else if (text == "ArrowUp")
                {
                    text = "up";
                }
                else if (text == "ArrowLeft")
                {
                    text = "left";
                }
                else if(text == "ArrowRight")
                {
                    text = "right";
                }
				console.log(text);
				$.ajax({
					type: 'POST',
					url: "/keyboard",
					data: {
							"text": text
						},
					success: function(result) { }
				});
			});

			$('#upload_button').click(function(event) {
			    var fd = new FormData();
			    var files = $('#upload_file')[0].files;
				if(files.length > 0 ){
                   fd.append('file',files[0]);
                   $.ajax({
                      url: '/upload_file/',
                      type: 'post',
                      data: fd,
                      contentType: false,
                      processData: false,
                      success: function(response){}
                   });

                }
			});

		
		});
	</script>
</html>